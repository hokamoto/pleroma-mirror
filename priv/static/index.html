<!DOCTYPE html>
<html lang=en>

<head>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Pleroma</title>
  <!--server-generated-meta-->
  <link rel=icon type=image/png href=/favicon.png> <link rel=stylesheet href=/static/font/css/fontello.css> <link
    rel=stylesheet href=/static/font/css/animation.css> <link href=/static/css/vendors~app.b2603a50868c68a1c192.css
    rel=stylesheet>
  <link href=/static/css/app.db80066bde2c96ea6198.css rel=stylesheet>
  <!-- <link rel="stylesheet" type="text/css" media="screen" href="/converse.js/converse.css">
  <script src="/converse.js/converse.js" charset="utf-8"></script> -->
  <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.conversejs.org/css/converse.min.css">
  <script src="https://cdn.conversejs.org/dist/converse.min.js" charset="utf-8"></script>
</head>

<body style="display: none">
  <div id=app></div>
  <script type="text/javascript">
    var request = new XMLHttpRequest();
    request.open('GET', '/xmpp/jid', true);
    request.onload = function () {
      if (request.status >= 200 && request.status < 400) {
        console.log("Got JID data: ", request.responseText)
        var data = JSON.parse(request.responseText);
        if (data) {
          converse.initialize({
            debug: true,
            authentication: 'prebind',
            prebind_url: data.prebind_url,
            keepalive: true,
            jid: data.jid,
            auto_away: 300,
            auto_reconnect: true,
            bosh_service_url: data.http_bind_url,
            message_archiving: 'always',
            view_mode: 'overlayed'
          });
        } else {
          console.log("Couldn't get data to connect to XMPP")
        }
      } else {
        console.error("Unexpected response, can't get data to connect to XMPP", request)
      }
    };
    request.onerror = function () {
      console.error("Connection error, can't get data to connect to XMPP")
    };
    request.send();
  </script>
  <script type=text/javascript src=/static/js/vendors~app.4b7be53256fba5c365c9.js> </script> <script
    type=text/javascript src=/static/js/app.670c36c0acc42fadb4fe.js> </script> </body> </html>